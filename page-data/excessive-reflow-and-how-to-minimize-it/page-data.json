{"componentChunkName":"component---src-templates-blog-post-js","path":"/excessive-reflow-and-how-to-minimize-it/","result":{"data":{"markdownRemark":{"html":"<p>Thanks to the advancement of Web APIs today many websites are becoming more and more dynamic — parts of a web page can be disassembled and swapped with a relevant piece of content that aims to help the user achieve a specific goal.</p>\n<p>But like every good thing, there's always a catch to it — It turns out there's a small price to pay every time a change is made to an element that can potentially shift the document however small it is.</p>\n<p>Such a process is known as <strong>Reflow</strong>. It is important that we understand what a reflow is, why it happens and what preventive measures we can take to minimize the cost.</p>\n<h2>What's a Reflow?</h2>\n<p>In short, Reflow is a user-blocking process in which a web browser recalculates the position and dimension of a UI element in order to ensure the element is rendered correctly.</p>\n<p>To understand why reflow happens in the first place, we have to understand how the browser actually renders UI elements onto the screen.</p>\n<h2>Critical Rendering Path</h2>\n<p>Web browser took a number of steps also known as CRP (Critical Rendering Path) in order to paint elements on your screen. Essentially there are four main steps: <strong>Parsing, Render Tree, Layout, and Paint</strong>.</p>\n<p>Consider the HTML and CSS codes below</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./styles.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n      Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>How are you?<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">p</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 12px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> 400<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">span</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Parsing</h3>\n<p>In this first step, HTML code was first parsed by the web browser in order to construct a DOM (Document Object Model) representing the nodes. If node contains a link to external resources, the parser will be halted until external resources are resolved.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/50ae6e0d9fcc580452ee943d84e2c18a/0eb6d/document-object-model.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACEklEQVQ4y51Uy27TQBTNL/EX/ANb1iwQq8IHsGCBxIYFCxYgEJuWIKoI8ZKAQCFULa1b4ldTO0njV+IHdvwY++AZ21Fih1L1Steje+f4+My9d9xCzbIsY05Ncr6jp29h4gvlXrrY+5e11hFW9ujoOu7sXEFHuc/iNCOXI6xeOjDf4O3gIRRv/3IKK/DipXxJIzRy/yVcVrWsIMsSeN4M52EahE1gBkJSkCRG/+QMnc8cNNNh+YuQturHjQngB3NE4Ry7x0O0uwNIygRJkoCsady5CgPXgjXkEYfBcmXZ84+tYzoSkETzRr2zRg3T4tvSzhb2XtzG5OSwGJO06Crdlb5tYvf5Bgz1d7lHSsJVxa3l7tmWBVtXQeKo1tkMjqXhTBHhe85Cdb2m1JlCQW3jVfcqpFGn5M5yBQWw/eMQN59sY38wZnFPOMWNxy+x/ZNbUbhCqE4+4evRLQy1bgkiiyN8OOBxd/MdFM1gsTjWcK/9EV+OJVorxHmzGk1p3pS8074PXdfhTC1aMfT6Mt7/4uEFRVN8z4VhmjAMA7PZDLZtI4qiarDT/J4mbK1IVVUFx3EQRBFBGGLj6Wtce/AMe7LKMJRMFAXwPI9+v8+wrus2r16lmBDCZo86zXl+APlUZUQ0RycgjuNiPksszbXWDee6wXUdB+PRCLIsw8xJL/xzqI9BFYf5sa3plJEFQdDAVP4X41IhcbFBTKAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Document Object Model\"\n        title=\"Document Object Model\"\n        src=\"/static/50ae6e0d9fcc580452ee943d84e2c18a/6af66/document-object-model.png\"\n        srcset=\"/static/50ae6e0d9fcc580452ee943d84e2c18a/69538/document-object-model.png 160w,\n/static/50ae6e0d9fcc580452ee943d84e2c18a/72799/document-object-model.png 320w,\n/static/50ae6e0d9fcc580452ee943d84e2c18a/6af66/document-object-model.png 640w,\n/static/50ae6e0d9fcc580452ee943d84e2c18a/0eb6d/document-object-model.png 913w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>When the parser encounters CSS codes, it will also construct CSSOM (CSS Object Model), a data structure containing information on how to style DOMs.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e990b3dacdb050bb0baf1210460029d3/321ea/css-object-model.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.74999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZ0lEQVQ4y5VTTUvDQBDN7xQ9e9Wf4cGDBxEvXkQteBCxhaI9CEWsoJZKaqVQq1K/6keTzWbT7CZ57m7UJpA0dOAxhJl5u+/txEBORFEUZ/8N4XBXYg8R/0zVssLIJxQ6h8MS/FNDI/wqp2ozEoZxpi34nXmJBUTsLlWbjTAhzecx/uTmC55CmPSKjblGkX+ZhP+P8Zu576F/fYx+swbB/cyeFKGWkInYJ49auDlahVlZg+eSiewMFErm/hgOsUHsGC6l8Jg71SIjCAKMLAuEENi2yg6iQKA3eMXyThUr5Tpc5umBUv0Si1uHqF6ZCLg8zHHAXAbG2OSGitCWZIqQ2EQ3qfiwbGycNLB/3kIk4gc569xjvXaBZu9JfwshoOYVpkpOWm2NvtFod9F+GMhCiKKtMJKGCs5BXaolUOoikB7WzS7mNg+wtF3Rt9Z/Txiq6fxHSa6Bak5mIolvH5/Re3mHkNKK1uYHWL7wCAdnHOwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CSS Object Model\"\n        title=\"CSS Object Model\"\n        src=\"/static/e990b3dacdb050bb0baf1210460029d3/6af66/css-object-model.png\"\n        srcset=\"/static/e990b3dacdb050bb0baf1210460029d3/69538/css-object-model.png 160w,\n/static/e990b3dacdb050bb0baf1210460029d3/72799/css-object-model.png 320w,\n/static/e990b3dacdb050bb0baf1210460029d3/6af66/css-object-model.png 640w,\n/static/e990b3dacdb050bb0baf1210460029d3/321ea/css-object-model.png 786w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Render Tree</h3>\n<p>With DOM and CSSOM ready, they will be combined into a document structure called <strong>Render Tree</strong>.</p>\n<p>Render Tree only captures visible content. <code class=\"language-text\">&lt;head&gt;</code> sections and elements that have a <code class=\"language-text\">display: none;</code> attached to it (and its descendants) are not included in the Render Tree.  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc86fa965dd7f180822567f3efcb8771/44fd6/render-tree.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACfElEQVQ4y5VUS2/TQBDOj+A3cOMX8DMQJy499Rdw4oiQOHHggqpKHMqtCKkBUiEUIUgPEEQrJSEJatQmdbDzcmwn9vr9+NidJG4e7oORxuudndc3M7s5rFEcJ7T22xYOXv5BYaeFD69Ocbjbgm0GdJYkCa6i3LogCmNaywUZD+68xfa9j9i6mycWQZaD3srhIjqb+jj9NUb9Rx/N8ghnFR1hEP9fhgvFVQM3M+DtHSaXRlEUo9KU0O6qc/ns7DqfudXIydwgQRxFGAyGODzWUDxWwCyTy+MrUNwAmYD6Ic8wQrs3QU81EfJ/P7oZdm454uJf753BUForho6pQe1UEbhsQ3/D4eXBbJVKu+h8fgHfddIztfUd5/knMOTmTDOOMh2nGcZxzGcwpBkbtSsYt08I8oIsTUG3+oUyXS7RMqc19L0ENvPgeR5838d8tlMjVTcwsRjlz2wHI02nCcia4Zztqjiqb6El7xHi6XQCi3fUmBik1JAUPHpdwH65Rvuj5jke7hzga+0USeCBMRuu615maNkKirX7qHWe87qAnJmcGeMZccgXgxGevS/hW+OcDOpSD0/zJTS6vVmpluBShuLD2JRD9TYgCPie58J3bHg2g8ebRIZhANdxMJkINBaCIEjrnTmHtm1jOBxSlvFc9u7nbzzeL6L5t0/7scbHSFVT1jRtdWyWW68oCrFQFBTyLPdKJ9h+8wnVCyV1KJzouk564/F48+otnBqGQYoCjiDRfcE6l4vRoiB8dThs0RDB4Vyeu+4lETUULEog6tTjWUuSBNM0M68dNSXr6Vo8FMJJ4Ac09MKxLMtUCtGMawf7qmjr+1nXvbSjWXf5H9coBebw0eFgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Render Tree\"\n        title=\"Render Tree\"\n        src=\"/static/dc86fa965dd7f180822567f3efcb8771/6af66/render-tree.png\"\n        srcset=\"/static/dc86fa965dd7f180822567f3efcb8771/69538/render-tree.png 160w,\n/static/dc86fa965dd7f180822567f3efcb8771/72799/render-tree.png 320w,\n/static/dc86fa965dd7f180822567f3efcb8771/6af66/render-tree.png 640w,\n/static/dc86fa965dd7f180822567f3efcb8771/44fd6/render-tree.png 789w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Layout</h3>\n<p>Before nodes can be painted, the web browser traverses through the Render Tree and performs a calculation in order to retrieve information such as the position, dimension, and relation of each element. This step is critical to ensure that elements are rendered correctly on the screen. The greater the number of nodes, the longer this step will take.</p>\n<h3>Paint</h3>\n<p>Finally with everything in place, web browser can render each pixel onto the screen.</p>\n<p>Notice that the <em>Layout</em> step is actually what we described as Reflow before, that's because they're essentially the same thing. This step is referred to as <em>Layout</em> during the initial CRP phase but is renamed as Reflow on subsequent calculation.</p>\n<p>The same also applied to the <em>Paint</em> step. During the CRP phase, this step is referred to as <em>Repaint</em>.</p>\n<h2>Many Reasons to Reflow</h2>\n<p>Reflow can happen for many reasons, but ultimately it comes down to both of these,</p>\n<ol>\n<li><strong>If the mutation is made to the document that can potentially cause a layout shift.</strong><br>\nThis is fairly straightforward. Whenever an element changes its position or dimension, the web browser is required to recalculate its surrounding (including its ancestors) in order to paint correctly.</li>\n<li><strong>If measurement happens after a mutation.</strong><br>\nWeb browser keeps a version of cache that contains intrinsic values of each node, a mutation made onto a DOM node will invalidate said cache thus requiring recalculation from the web browser.</li>\n</ol>\n<p>Here's a non-exhaustive list of reasons why reflow happens and what can you do about it.</p>\n<h3>DOM Manipulation</h3>\n<p>The most common cause of Reflow is probably this one. Action such as DOM insertion, deletion, or update changes the overall structure of the document hence recalculation is needed in order to reflect changes accurately onto the screen.</p>\n<p>Consider an example of DOM insertion below</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token keyword\">function</span> <span class=\"token function\">addElement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        el<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Appended!'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> hello <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">,</span> hello<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Insert before the div will cause layout shift</span>\n      <span class=\"token punctuation\">}</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>addElement()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Add an element<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hello<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Every time we click on a <code class=\"language-text\">Add an element</code> button, an element is appended to the document thus triggering a reflow.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/16c16adfc2f758c794f6d9f6a47cc4ad/a0b80/excessive-reflow-unoptimized.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.37500000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABjklEQVQoz42RXWsTQRSG9/8j4hd4451VqeBtiv1AqU2tKKjxQlMTm27YzOxmZr9mNrPZ3ezjpCpaEHTgmXnPgfPOCycIF5JEZ0QyIRLJTx0jlhmTMOZ8JpC6JCsMKv9Bmv+hi9/kpSGQcUK1cr6ouJhLtFZUpeLLPCWMhP9EMFlkuEKwUAWx0qxy3/d6qRSrImHTWPrGYKw3fLAfsvtaM3gnefEh4u3EcPRecDwSvPqcs3M4Y3cY8/QsY+dE83iYejSPhvrq3fLkNOXhScp4nhHcHCju7En2PjneTGtejhYcj2vOvlbsfxTcfZZzf5Bw7yjj1oHl9oHx2OscGm48t4y+pQR9ndFYBWzwuanUudcNbV3RV1OcqimWS99b8a/T+JlAJgrhF9K0Ha5uWMoLum5NaSrKLCSarbicJZjK0vXQ+uuv+DzGWgKlNdJvtes61usGtRjTbxqMsZh0irx0hDPpF2evUvR9fy3Vtv7Vs1vDsizJ89wbbmjbliKNvGGLcw5nBGmyJokz6tr9l+F3xKhU0TWUtlYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Performance before batching\"\n        title=\"Performance before batching\"\n        src=\"/static/16c16adfc2f758c794f6d9f6a47cc4ad/6af66/excessive-reflow-unoptimized.png\"\n        srcset=\"/static/16c16adfc2f758c794f6d9f6a47cc4ad/69538/excessive-reflow-unoptimized.png 160w,\n/static/16c16adfc2f758c794f6d9f6a47cc4ad/72799/excessive-reflow-unoptimized.png 320w,\n/static/16c16adfc2f758c794f6d9f6a47cc4ad/6af66/excessive-reflow-unoptimized.png 640w,\n/static/16c16adfc2f758c794f6d9f6a47cc4ad/a0b80/excessive-reflow-unoptimized.png 955w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As we've mentioned before, reflow is a costly operation because it is user-blocking.</p>\n<p>One way to fix this is to batch changes together in a temporary document called <strong>DocumentFragment</strong> — A lightweight version of Document that stores DOM nodes just like a standard document. Since <strong>DocumentFragment</strong> is detached from the active document, any changes made onto it won't cause a reflow.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hello<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> fragment <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DocumentFragment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">20</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          el<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Appended!'</span><span class=\"token punctuation\">;</span>\n          fragment<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">prepend</span><span class=\"token punctuation\">(</span>fragment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>With this approach, only a single change is made directly to the active document therefore only a single reflow occurred.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/799a67bd74f3c4710007e711babf7a3b/146da/excessive-reflow-optimized.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.625000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCklEQVQY04WMS0sCURiG50+3bi8a1KZFtQvJTCIqmSxUgrRyE11oUZE2ORedmTMXxRxn5uno2CII+uDheTnf+x1Ft2xcL2AyjXBEwKdu8jUWCOHw1HMZmH1edA/DGhAKi1cjIHANPDHkzfAJZZ6MBEk0YjoJUbZrXYqXfSo3Dls1jeaDTePRY+f8g6tnh9OOSbHe47Aj2G877ElKLTuj7S58IG/L1y4X9wIlV/VYO9FZVwfkjjWqt10qLY28zI27d3abNoWSw4ZqUlAD8mfhLwqS1aOAlbLPZt1HYTHxkjGkvnSY5cSTnkrS5f6/iVFmcUoi+3PPEvmHfJ57TrrI2T7+6fxBvOxE0YxvAwttvbHQ1VAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Performance after batching\"\n        title=\"Performance after batching\"\n        src=\"/static/799a67bd74f3c4710007e711babf7a3b/6af66/excessive-reflow-optimized.png\"\n        srcset=\"/static/799a67bd74f3c4710007e711babf7a3b/69538/excessive-reflow-optimized.png 160w,\n/static/799a67bd74f3c4710007e711babf7a3b/72799/excessive-reflow-optimized.png 320w,\n/static/799a67bd74f3c4710007e711babf7a3b/6af66/excessive-reflow-optimized.png 640w,\n/static/799a67bd74f3c4710007e711babf7a3b/146da/excessive-reflow-optimized.png 943w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Style Change</h3>\n<p>Reflow can also happen when we change appearance of an element. In this example, we use Javascript to update the <code class=\"language-text\">height</code> of the <code class=\"language-text\">div</code> element. </p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> box <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n        box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>marginTop <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n        box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>left <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Since this script changes the dimensional and positional value of the element, it could mean multiple reflows.</p>\n<p>Just like DOM manipulation, we can try to limit reflow by grouping together relevant changes in a single pass.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> box <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> newStyle <span class=\"token operator\">=</span> <span class=\"token string\">'height: 100; margin-top: 50;'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span><span class=\"token punctuation\">(</span>box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>cssText<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>cssText <span class=\"token operator\">=</span> newStyle<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          box<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'style'</span><span class=\"token punctuation\">,</span> newStyle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Fallback if `cssText` is not supported</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3>Measurement</h3>\n<p>It turns out certain web APIs that are used to retrieve the positions or dimensions of an element also trigger a reflow even though no apparent change is made to the element.</p>\n<p>This is due to the fact that measurement values are cached and can be invalidated at a certain point of time and recalculation is often required in order to provide the correct values.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Box 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Box 2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box3<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Box 3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> height1 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n      \tdocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height1 <span class=\"token operator\">+</span> <span class=\"token number\">10</span> <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> height2 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height2 <span class=\"token operator\">+</span> <span class=\"token number\">10</span> <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> height3 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height3 <span class=\"token operator\">+</span> <span class=\"token number\">10</span> <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This code results in a multiple reflow because each modification likely invalidates caches.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/18d31ae40119b8bdbf3bef2d43e9a21b/d9199/measurement-reflows.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABLUlEQVQoz3WOTU/CQBCG+0v9BR6Vo548+Rc8eDAx4QTcNPFiTPwARTBKqgkgpCnQbj/otgRh+7iAtQ3RSSbz7M4774xx1ehz82LR6oU8doa89hzeh2LN7a6g/jbkumXR+BA8mC63pk/dHHNvCu5MT/OEdi/Q8wGfowCjVPYondscVR1qTclFc0yl7lF7mnL5bHNcFRycjjisuOyXA50+e+ua8+6Zx86JR7UuMNAReg7zmVwhUnT5ktaaI6fDPPSx+xGz2OO/mEwVdqhwgxhjqTQIjyiSpKk2DwKSyGWpwPcnxGGENYjwAx8tRWlRlqnOxTKl7y4YCIXjx5sLV5H+CDZMgVOKmmLk701NkgQjM1IqM1yxIv/PmTRfXFyY8a/hdkMVhv66dPvKrCel5BtRPhAgsgk0/wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/18d31ae40119b8bdbf3bef2d43e9a21b/6af66/measurement-reflows.png\"\n        srcset=\"/static/18d31ae40119b8bdbf3bef2d43e9a21b/69538/measurement-reflows.png 160w,\n/static/18d31ae40119b8bdbf3bef2d43e9a21b/72799/measurement-reflows.png 320w,\n/static/18d31ae40119b8bdbf3bef2d43e9a21b/6af66/measurement-reflows.png 640w,\n/static/18d31ae40119b8bdbf3bef2d43e9a21b/d9199/measurement-reflows.png 960w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We can optimize this code to have a single reflow</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Box 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Box 2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>box3<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Box 3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> height1 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> height2 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> height3 <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n\t\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height1 <span class=\"token operator\">+</span> <span class=\"token number\">10</span> <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height2 <span class=\"token operator\">+</span> <span class=\"token number\">10</span> <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#box3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height3 <span class=\"token operator\">+</span> <span class=\"token number\">10</span> <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/52fa094bf60d5d0fe6190107dfb20c0c/fbf08/measurement-reflows-optimized.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA1UlEQVQY033M206DQBSFYd7/zYyJMW3ayqEwAzMcBhhOGkIFfkG98KJ2JTvru1jZjidy4sxihxuRrgmTHNs0yNRwFJZEaQ5RRWos2tT4aY8xBco0mzsKY2j6gf79g3Zr53RxeXk9cn7ziWSMTBSxSgkjiVIKzxc8P504ux5BKLlGAn/rIBSb5a8lXhChsxyn277KOEGnGdPtE1tXtPXumdKkVEXJ5VBsG0Hb9ez7v9d2A4HucJOOrGxxuJv1Hz/ONE048zyzrivLsnz3j9e7fnR7xnHkC1eJfIY5A7aaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/52fa094bf60d5d0fe6190107dfb20c0c/6af66/measurement-reflows-optimized.png\"\n        srcset=\"/static/52fa094bf60d5d0fe6190107dfb20c0c/69538/measurement-reflows-optimized.png 160w,\n/static/52fa094bf60d5d0fe6190107dfb20c0c/72799/measurement-reflows-optimized.png 320w,\n/static/52fa094bf60d5d0fe6190107dfb20c0c/6af66/measurement-reflows-optimized.png 640w,\n/static/52fa094bf60d5d0fe6190107dfb20c0c/d9199/measurement-reflows-optimized.png 960w,\n/static/52fa094bf60d5d0fe6190107dfb20c0c/fbf08/measurement-reflows-optimized.png 962w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Image Load</h3>\n<p>Images take time to load, and only when the asset is loaded can we know the dimension of the image. This not only triggers a reflow but is also bad for user experience due to <strong>layout shifts</strong>.</p>\n<p>The fix to this is straightforward, simply <strong>add a fixed width and height</strong> to the image element if the dimension is known ahead of time.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>This approach however won't work for responsive design, in this case use aspect ratio to maintain the dimension of the image.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n      <span class=\"token selector\">.container</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">padding-bottom</span><span class=\"token punctuation\">:</span> 56.25%<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n \n      <span class=\"token selector\">.image</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3>Window Resize</h3>\n<p>Although there is not much that can be done when it comes to reflow caused by window resize, it is advisable to minimize measurement by debouncing the event handler attached in the resize event.</p>\n<h3>Hidden vs None</h3>\n<p>Whenever an element needs to be hidden but not necessarily removed from the DOM tree, we can use <code class=\"language-text\">visibility: hidden</code> instead of <code class=\"language-text\">display: none</code> since hidden element still takes up spaces, the browser only repaints the element (without reflow).</p>\n<h3>Dealing with animations</h3>\n<p>CSS animation relies on changing the initial positional value of an element to a specific value, unavoidably resulting in a reflow. We can lessen the reflow impact by applying animation with <code class=\"language-text\">position: fixed or absolute</code> so it doesn't affect other elements.</p>\n<h2>Conclusion</h2>\n<p>It is very less likely that we can avoid reflow entirely as it is a part of the process the web browser took to reflect changes accurately. Many web browsers today came up with solutions to deal with excessive reflow — Some are baked directly into the web browser workflows while others require manual intervention.</p>\n<p>Hopefully, this post can provide a better understanding of how the browser works internally and how can you deal with excessive reflows through a number of best practices.</p>","frontmatter":{"title":"Excessive Reflow and How to Minimize It","date":"2021-12-05","shortDesc":"Understand how the web browser render stuffs on your screen and what to do with excessive reflows.","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAcqHPbzBAP8A/8QAGxAAAgIDAQAAAAAAAAAAAAAAAQIAEQMEEhT/2gAIAQEAAQUCXDbeRabm0m2xAE//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwFCf//EABcRAAMBAAAAAAAAAAAAAAAAAAABAhL/2gAIAQIBAT8Bps0f/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQESEy/9oACAEBAAY/AqtnTMhJR//EABkQAQEBAQEBAAAAAAAAAAAAAAEAETFhcf/aAAgBAQABPyHORD7IpfrsAxGTZ4sHuS7f/9oADAMBAAIAAwAAABBbL//EABYRAQEBAAAAAAAAAAAAAAAAABEAAf/aAAgBAwEBPxBjmRf/xAAWEQEBAQAAAAAAAAAAAAAAAAABACH/2gAIAQIBAT8QJgyr/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPxAStN6EZqLoHgiARcKUx1XFMuUJBx2MHWek/9k=","aspectRatio":1.702127659574468,"src":"/static/6f0907cf976e033501137e1f182483b4/f422e/reflow.jpg","srcSet":"/static/6f0907cf976e033501137e1f182483b4/e75b5/reflow.jpg 160w,\n/static/6f0907cf976e033501137e1f182483b4/c01e2/reflow.jpg 320w,\n/static/6f0907cf976e033501137e1f182483b4/f422e/reflow.jpg 640w,\n/static/6f0907cf976e033501137e1f182483b4/a6352/reflow.jpg 960w,\n/static/6f0907cf976e033501137e1f182483b4/ec6c5/reflow.jpg 1280w,\n/static/6f0907cf976e033501137e1f182483b4/d8255/reflow.jpg 1920w","sizes":"(max-width: 640px) 100vw, 640px"}}}},"timeToRead":9,"excerpt":"Thanks to the advancement of Web APIs today many websites are becoming more and more dynamic — parts of a web page can be disassembled and…","fields":{"slug":"/excessive-reflow-and-how-to-minimize-it/"}}},"pageContext":{"slug":"/excessive-reflow-and-how-to-minimize-it/"}},"staticQueryHashes":["3649515864","572726844"]}