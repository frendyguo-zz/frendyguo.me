<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.5rem 'Nunito Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Nunito Sans',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:hsla(0,0%,0%,0.9);font-family:'Nunito Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:hsla(0,0%,0%,0.9);font-family:'Nunito Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.65572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:hsla(0,0%,0%,0.9);font-family:'Nunito Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.32951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:hsla(0,0%,0%,0.9);font-family:'Nunito Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:hsla(0,0%,0%,0.9);font-family:'Nunito Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;color:hsla(0,0%,0%,0.9);font-family:'Nunito Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}ul{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:0.85rem;line-height:1.5rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:1rem;line-height:1.5rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}blockquote{margin-left:1.5rem;margin-right:1.5rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.2rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.2rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.5rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}li > ul{margin-left:1.5rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.2rem / 2);}code{font-size:0.85rem;line-height:1.5rem;}kbd{font-size:0.85rem;line-height:1.5rem;}samp{font-size:0.85rem;line-height:1.5rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:calc(0.75rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:var(--textLink);text-decoration:none;}a:hover{color:var(--textLinkHover);}h1, h2{margin-top:3.5rem;}h3, h4, h5, h6{margin-top:2.8rem;}</style><style data-href="/styles.646e95958bd708a50209.css" id="gatsby-global-css">*{box-sizing:border-box}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;--darkBg:#2c2c35;--coral:#fa7268;--deepScarlet:#7f0800;--textLink:#fa7268;--textLinkHover:#7f0800}.gatsby-highlight{margin-bottom:16px}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#282a36}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#6272a4}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ff79c6}.token.boolean,.token.number{color:#bd93f9}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#50fa7b}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#f1fa8c}.token.keyword{color:#8be9fd}.token.important,.token.regex{color:#ffb86c}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;z-index:0;pointer-events:none;line-height:inherit;white-space:pre}.mBrand{display:inline-block;height:56px;width:56px;border-radius:8px;line-height:56px;text-align:center;font-family:Alegreya Sans SC,sans-serif;background-color:#000}.mBrand-link{margin-top:1px;-webkit-user-select:none;-ms-user-select:none;user-select:none;display:inline-block;font-size:32px;color:#fff;text-decoration:none}.mBrand-link:hover{color:#fff}.mHeader{background-color:#fff;top:0;left:0;width:100%;z-index:100;padding:16px}.mHeader-wrapper{max-width:640px;margin:0 auto;align-items:center}.mHeader-menu,.mHeader-wrapper{display:flex;justify-content:space-between}.mHeader-menuLink{color:#fff;font-size:13px;font-weight:700;margin-left:10px}.mHeader-menuLink:first-child{margin-left:0}.mHeader-menuLink:hover{color:#fff}@media screen and (min-width:768px){.mHeader{padding:24px 0 0}.mHeader-wrapper{padding:0}}@media screen and (min-width:992px){.mHeader-wrapper{margin-left:180px}}@media screen and (min-width:1200px){.mHeader-wrapper{margin-left:248px}}.mLayout{min-height:100vh;display:flex;flex-direction:column;justify-content:space-between}.mLayout-main{height:100%}.mLayout-footer,.mLayout-main{background-color:#fff;position:relative}.mLayout-footer{border-top:1px solid #111827}.mLayout-footerCredit{padding:8px 16px;margin:0;text-align:center;font-size:14px;font-weight:600;color:#111827}.m404Page-wrapper{max-width:640px;margin:0 auto;padding:80px 20px 0;text-align:center}.m404Page-heading{font-size:48px;color:var(--coral);margin:0}.m404Page-description{font-size:16px;font-weight:600;margin:6px 0 0}@media screen and (min-width:768px){.m404Page-wrapper{text-align:left;padding-top:140px;padding-left:0;padding-right:0}.m404Page-heading{font-size:64px}.m404Page-description{font-size:24px}}@media screen and (min-width:992px){.m404Page-wrapper{margin-left:180px}}@media screen and (min-width:1200px){.m404Page-wrapper{margin-left:248px}}.mProfile-wrapper{display:flex;justify-content:flex-start}.mProfile-avatar{width:80px;flex:0 0 auto!important}.mProfile-avatarSrc{padding-bottom:100%;background-color:#dfdfdf;border-radius:50%;background-size:cover;background-position:top}.mProfile-info{margin-right:16px;display:flex;align-items:center}.mProfile-infoGreet>h1{font-size:30px;font-weight:700;margin:8px 0 0}.mProfile-infoGreet>h1,.mProfile-infoGreet>p{color:#121212;font-family:-apple-system,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,system-ui,Apple Color Emoji,Segoe UI Emoji}.mProfile-infoGreet>p{margin:14px 0 0;line-height:1.75;font-weight:400;font-size:20px}.mProfile-infoGreet>p>a{color:#111827;font-weight:600;text-decoration:underline}.mProfile-infoGreet>p>a:focus,.mProfile-infoGreet>p>a:hover,.mProfile-infoGreet>p>a:link,.mProfile-infoGreet>p>a:visited{color:#111827}.mProfile-infoName{font-size:18px;line-height:24px;font-weight:600;margin:0}.mProfile-infoRole{font-size:14px;line-height:16px;margin:0}.mProfile-infoRoleCompany{color:#fa7268}.mProfile-infoDesc{font-size:14px;margin:8px 0 0;color:#777;line-height:16px}@media screen and (min-width:768px){.mProfile-wrapper{justify-content:flex-start}.mProfile-info{margin-right:20px}.mProfile-infoName{font-size:28px;line-height:34px}.mProfile-infoGreet>h1{font-size:34px}.mProfile-infoGreet>p{font-size:18px}.mProfile-infoRole{font-size:15px;line-height:22px}.mProfile-infoDesc{font-size:15px;line-height:18px}.mProfile-avatar{width:110px}}.mHomePage{padding:0 20px 48px;margin:0 auto;max-width:640px}.mHomePage-separator{width:32.5%;height:1px;background-color:#111827;margin:32px 0}.mHomePage-blog{margin-top:24px}.mHomePage-blogPost{margin-top:64px}.mHomePage-blogPost:first-child{margin-top:0}.mHomePage-blogPostByline{font-size:14px;line-height:20px;margin-top:6px;color:#969696;font-weight:500}.mHomePage-blogPostBylineDivider{padding:0 6px;display:inline;font-weight:700}.mHomePage-blogPostBylineDivider:after{content:"\B7"}.mHomePage-blogPostTitle{font-family:-apple-system,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,system-ui,Apple Color Emoji,Segoe UI Emoji;font-size:24px;line-height:31px;color:#222;font-weight:700;margin:0}.mHomePage-blogPostTitle>a{color:#222}.mHomePage-blogPostExcerpt{font-family:-apple-system,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,system-ui,Apple Color Emoji,Segoe UI Emoji;color:rgba(0,0,0,.75);margin:4px 0 0;font-size:16px;line-height:1.556;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}@media screen and (min-width:768px){.mHomePage{padding-top:32px;padding-left:0;padding-right:0}.mHomePage-separator{margin:48px 0 0;width:160px}.mHomePage-blog{margin-top:48px}}@media screen and (min-width:992px){.mHomePage{margin-left:180px;padding-left:0;padding-right:0;padding-bottom:120px}}@media screen and (min-width:1200px){.mHomePage{margin-left:248px}}.mPostPage{padding:0 0 48px;margin:0 auto;max-width:640px}.mPostPage-fmCover{margin:16px 0 0}.mPostPage-fmCoverSrc{margin:0;display:block}.mPostPage-fmInfo{padding:0 20px}.mPostPage-fmInfoTitle{color:rgba(0,0,0,.84);font-size:27px;line-height:36px;margin:0;font-weight:700}.mPostPage-fmInfoByline{font-size:13px;line-height:16px;margin-top:6px;color:#646464;font-weight:500}.mPostPage-fmInfoBylineDivider{padding:0 6px;display:inline;font-weight:700}.mPostPage-fmInfoBylineDivider:after{content:"\B7"}.mPostPage-content{padding:0 20px;margin-top:20px}@media screen and (min-width:768px){.mPostPage-fm{padding-top:24px}.mPostPage-fmInfo{padding-left:0;padding-right:0}.mPostPage-fmInfoTitle{font-size:36px;line-height:44px}.mPostPage-fmCover{padding:0;margin-top:20px;margin-left:-32px;margin-right:-32px;border-radius:8px;overflow:hidden}.mPostPage-content{padding:0;margin-top:24px}}@media screen and (min-width:992px){.mPostPage{margin-left:180px;padding-left:0;padding-right:0;padding-bottom:120px}}@media screen and (min-width:1200px){.mPostPage{margin-left:248px}}</style><meta name="generator" content="Gatsby 2.32.3"/><title data-react-helmet="true">Dealing With Test Doubles — Frendy Guo | Personal Blog</title><meta data-react-helmet="true" name="description" content="Learn the differences of various test doubles"/><meta data-react-helmet="true" property="og:title" content="Dealing With Test Doubles"/><meta data-react-helmet="true" property="og:description" content="Learn the differences of various test doubles"/><meta data-react-helmet="true" property="og:url" content="https://frendyguo.me/dealing-with-test-doubles/"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@frendyguo"/><meta data-react-helmet="true" name="twitter:title" content="Dealing With Test Doubles"/><meta data-react-helmet="true" name="twitter:description" content="Learn the differences of various test doubles"/><meta data-react-helmet="true" name="google-site-verification" content="rMoO_lFxVeo560aiNPbEMWe7Z0XsY0ktdy1S3sm98vg"/><meta data-react-helmet="true" property="og:image" content="https://frendyguo.me/static/babc7590673906526aed73b7719c1628/f422e/stones.jpg"/><meta data-react-helmet="true" name="twitter:image" content="https://frendyguo.me/static/babc7590673906526aed73b7719c1628/f422e/stones.jpg"/><link rel="icon" href="/favicon-32x32.png?v=db5609c76cb3c8e554e204d0faa0e78b" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=db5609c76cb3c8e554e204d0faa0e78b"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/alegreyasanssc/v13/mtGm4-RGJqfMvt7P8FUr0Q1j-Hf1DspC4iNhMA.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/nunitosans/v8/pe0qMImSLYBIv1o4X1M8cce9I9s.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/nunitosans/v8/pe03MImSLYBIv1o4X1M8cc9iB85tU1E.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/nunitosans/v8/pe03MImSLYBIv1o4X1M8cc8GBs5tU1E.woff2"/><style>@font-face{font-family:Alegreya Sans SC;font-style:normal;font-weight:900;src:url(/static/webfonts/s/alegreyasanssc/v13/mtGm4-RGJqfMvt7P8FUr0Q1j-Hf1DspC4iNhMA.woff2) format("woff2");font-display:swap}@font-face{font-family:Alegreya Sans SC;font-style:normal;font-weight:900;src:url(/static/webfonts/s/alegreyasanssc/v13/mtGm4-RGJqfMvt7P8FUr0Q1j-Hf1DspC4iNhNg.woff) format("woff");font-display:swap}@font-face{font-family:Nunito Sans;font-style:normal;font-weight:400;src:url(/static/webfonts/s/nunitosans/v8/pe0qMImSLYBIv1o4X1M8cce9I9s.woff2) format("woff2");font-display:swap}@font-face{font-family:Nunito Sans;font-style:normal;font-weight:600;src:url(/static/webfonts/s/nunitosans/v8/pe03MImSLYBIv1o4X1M8cc9iB85tU1E.woff2) format("woff2");font-display:swap}@font-face{font-family:Nunito Sans;font-style:normal;font-weight:700;src:url(/static/webfonts/s/nunitosans/v8/pe03MImSLYBIv1o4X1M8cc8GBs5tU1E.woff2) format("woff2");font-display:swap}@font-face{font-family:Nunito Sans;font-style:normal;font-weight:400;src:url(/static/webfonts/s/nunitosans/v8/pe0qMImSLYBIv1o4X1M8cce9I90.woff) format("woff");font-display:swap}@font-face{font-family:Nunito Sans;font-style:normal;font-weight:600;src:url(/static/webfonts/s/nunitosans/v8/pe03MImSLYBIv1o4X1M8cc9iB85tU1c.woff) format("woff");font-display:swap}@font-face{font-family:Nunito Sans;font-style:normal;font-weight:700;src:url(/static/webfonts/s/nunitosans/v8/pe03MImSLYBIv1o4X1M8cc8GBs5tU1c.woff) format("woff");font-display:swap}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-22ca6dc067203d68eff5.js"/><link as="script" rel="preload" href="/framework-dbb498007a7447f28d8e.js"/><link as="script" rel="preload" href="/app-54ca34367b76cbcfcbfe.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/commons-df320379cf55a57ae8d5.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-64d206a24b3414758a47.js"/><link as="fetch" rel="preload" href="/page-data/dealing-with-test-doubles/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/572726844.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="mLayout"><header class="mHeader"><div class="mHeader-wrapper"><div class="mBrand"><a class="mBrand-link" href="/">FG.</a></div></div></header><main class="mLayout-main"><div class="mPostPage"><div class="mPostPage-fm"><div class="mPostPage-fmWrapper"><div class="mPostPage-fmInfo"><h1 class="mPostPage-fmInfoTitle">Dealing With Test Doubles</h1><div class="mPostPage-fmInfoByline"><span>December 24, 2021</span><div class="mPostPage-fmInfoBylineDivider"></div><span>8<!-- --> min read</span></div></div><div class="mPostPage-fmCover"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;max-height:400px"><div aria-hidden="true" style="width:100%;padding-bottom:66.25%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABVlNmWEUxv//EABkQAAMBAQEAAAAAAAAAAAAAAAABAgMRBP/aAAgBAQABBQKK6W+iFkmPCKH55T//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwGH/8QAGBAAAgMAAAAAAAAAAAAAAAAAARAAMUH/2gAIAQEABj8CYxWZ/8QAGhABAQEAAwEAAAAAAAAAAAAAAREAEDFRIf/aAAgBAQABPyFFe11lkdAfcEgEeGI6k844/wD/2gAMAwEAAgADAAAAEMMP/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxCoY//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPxC01//EABwQAQEBAQACAwAAAAAAAAAAAAERACExQVFh0f/aAAgBAQABPxA+r3V13uE57yQC9zUIGxX6yOqDK0geL5Pzf//Z" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/babc7590673906526aed73b7719c1628/e75b5/stones.jpg 160w,
/static/babc7590673906526aed73b7719c1628/c01e2/stones.jpg 320w,
/static/babc7590673906526aed73b7719c1628/f422e/stones.jpg 640w,
/static/babc7590673906526aed73b7719c1628/a6352/stones.jpg 960w,
/static/babc7590673906526aed73b7719c1628/ec6c5/stones.jpg 1280w,
/static/babc7590673906526aed73b7719c1628/c361f/stones.jpg 4256w" sizes="(max-width: 640px) 100vw, 640px" /><img loading="lazy" sizes="(max-width: 640px) 100vw, 640px" srcset="/static/babc7590673906526aed73b7719c1628/e75b5/stones.jpg 160w,
/static/babc7590673906526aed73b7719c1628/c01e2/stones.jpg 320w,
/static/babc7590673906526aed73b7719c1628/f422e/stones.jpg 640w,
/static/babc7590673906526aed73b7719c1628/a6352/stones.jpg 960w,
/static/babc7590673906526aed73b7719c1628/ec6c5/stones.jpg 1280w,
/static/babc7590673906526aed73b7719c1628/c361f/stones.jpg 4256w" src="/static/babc7590673906526aed73b7719c1628/f422e/stones.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div></div></div><div class="mPostPage-content"><p>No doubt testing is one of the most important parts of software development. Many tools have been developed to make the process of testing easier. But often time engineers are reluctant to write test because of two reasons, <strong>brittle and slow tests</strong>.</p>
<p>Test is considered brittle if it fails due to unrelated change that does not introduce any bugs on production codes. This can happen if the test is validating implementation details rather than the public APIs.</p>
<p>On the other hand, slow test can be due to many reasons. Maybe the test is performing an HTTP request that adds up the latency, maybe the test has to simulate delays in order to satisfy certain conditions, and so and so. Few of these are fine, but imagine hundreds of test cases with each adding a few seconds to the runtime, the test will likely take hours to finish. </p>
<p>In such cases, <strong>test doubles</strong> can be handy.</p>
<h2>Test Doubles</h2>
<p>If the term test double feels rather strange to you, that's because we have been mostly using the word "mock" to refer to the whole family of objects that are used in test.</p>
<p>Just like how a stunt double stands in for an actor in order to perform physically demanding stuffs, test double is used as a substitute for the real implementation. A test double is simply a stand-in object or function that behaves similarly to that of a real implementation. It is an ideal choice when using the real production service is simply not feasible. </p>
<p>Can you imagine the incurred cost of having to actually proceed with payment on credit-card payment service every time we run a test case?</p>
<p>There's a short blog post titled <a href="https://blog.cleancoder.com/uncle-bob/2014/05/14/TheLittleMocker.html" target="_blank" rel="nofollow noopener noreferrer">The Little Mocker</a> written by Robert Martin (also known as Uncle Bob) that hilariously explains the relationship between various kinds of test double.</p>
<p>In short, test doubles are comprised of dummies, fakes, stubs, spies, and mocks. Each enables a different style of testing.</p>
<p>Out of these, Dummy objects have no real behavior, they're only passed around to fulfill parameter lists, while the rest work a bit differently. It is particularly helpful for engineers to understand how each technique work and what are the downsides of it.</p>
<h3>Fakes</h3>
<p>First, we have fakes, a lightweight version of an API, object, or function. Fakes behave similarly to real objects, they have business behavior but usually take some shortcuts in order to simplify. </p>
<p>An example of this would be an in-memory database that stands in for real database.</p>
<p>Fakes can be constructed without help from mocking frameworks such as <a href="https://jestjs.io/" target="_blank" rel="nofollow noopener noreferrer">Jest</a> or <a href="https://sinonjs.org/" target="_blank" rel="nofollow noopener noreferrer">Sinon</a>. An example of a fake object in Typescript,</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Payload</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Authentication</span> <span class="token punctuation">{</span>
  isAuthenticated<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function-variable function">authenticate</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> Payload<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FakeAuthentication</span> <span class="token keyword">implements</span> <span class="token class-name">Authentication</span> <span class="token punctuation">{</span>
  isAuthenticated<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token function">authenticate</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> Payload<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">'Bob'</span> <span class="token operator">&amp;&amp;</span> payload<span class="token punctuation">.</span>password <span class="token operator">===</span> <span class="token string">'Ross'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>isAuthenticated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> fakeAuth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FakeAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">'Ross'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'test fakeAuth'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  fakeAuth<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fakeAuth<span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ✅</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>With fakes, real implementation can be replaced with a fake one. In the example above, we created a fake authentication class that closely follows the authentication API contract, this class can later be used as a replacement of real authentication as long as the interface matches.</p>
<p>A rather important concept surrounding the creation of test doubles is <em>fidelity</em>, that is how closely the behavior of a fake matches the behavior of the real implementation. The higher the fidelity, the better, that means the fakes resemble more closely to production codes and in turn, we can rely on them to catch bugs in the event of breakages.</p>
<p>However, one downside of fakes is that they can be difficult to create and burdensome to maintain.</p>
<h3>Stubs and Spies</h3>
<p>Other techniques are stub and spy. By definition, stubbing is a process of adding behavior to a function that otherwise does not yet exist. Though, can also be used to replace an existing behavior in order to avoid having to deal with dependency.</p>
<p>Spies on the other hand are just stubs but they keep track of invocation such that you can verify how many times they're being called.</p>
<p>In Jest, stubs and spies are the same thing, they can be created with <code class="language-text">jest.spyOn()</code>,</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function-variable function">getCount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function-variable function">getCountText</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myCounter<span class="token operator">:</span> Counter <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getCount</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getCountText</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'More than 10'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> count<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>myCounter<span class="token punctuation">,</span> <span class="token string">'getCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockReturnValue</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>myCounter<span class="token punctuation">.</span><span class="token function">getCountText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'More than 10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In the example above, we stub a behavior on <code class="language-text">getCount</code> method such that it will always return a value <code class="language-text">20</code> no matter what.</p>
<p>Stubs are appropriate when there's a need to simulate a wide variety of return values that might not be possible should we use real implementation or fakes.</p>
<p>Additionally, since Jest treats stub and spy object as the same thing, that means we can verify that the object is indeed being invoked.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">  <span class="token function">expect</span><span class="token punctuation">(</span>mockCounter<span class="token punctuation">.</span>getCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span></code></pre></div>
<p>Because stubbing is so easy to apply, it can be tempting to treat it as easy patch to otherwise non-trivial behaviors. Deviation from real implementation is a real concern if we excessively rely on stubs to customize implementations.</p>
<h3>Mocks</h3>
<p>You might notice that up until now, what we're doing is simply validating if the "state" is correct given conditions. In other words, we're doing a state verification, a test that verifies whether the exercised method worked correctly by verifying the state of the system under test.</p>
<p>The thing is, the system under tests may or may not be stateful, in which case we need to employ behavior verification testing, a test that verifies invocation of a certain method. And this is where mocks came into play.</p>
<p>Mocks are pre-programmed objects with the ability to observe invocations. During test, the mocked object is used instead of the real object, this is a good way to ensure that side-effects do not happen. And more, we can set assertions such that the test should fail if a function isn't called at all, called with the wrong arguments, or called too many times.</p>
<p>Suppose we have an object called <code class="language-text">analytics</code> that contains a number of methods that look like this,</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// analytics.ts</span>
<span class="token keyword">const</span> analytics <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">sendEvent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>eventName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// send even to analytics dashboard;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sendButtonClickEvent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendEvent</span><span class="token punctuation">(</span><span class="token string">'button-click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sendInitEvent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendEvent</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> analytics<span class="token punctuation">;</span></code></pre></div>
<p>We probably don't want to send an actual event to the analytics dashboard during tests, but we do need to make sure that they're called.</p>
<p>To solve this, we can mock the <code class="language-text">analytics</code> module,</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./analytics'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'test analytics module'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> analytics <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./analytics'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>analytics<span class="token punctuation">.</span>sendEvent<span class="token punctuation">.</span>_isMockFunction<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ✅</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>analytics<span class="token punctuation">.</span>sendButtonClickEvent<span class="token punctuation">.</span>_isMockFunction<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ✅</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>analytics<span class="token punctuation">.</span>sendInitEvent<span class="token punctuation">.</span>_isMockFunction<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ✅</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">jest.mock(&#39;./analytics&#39;)</code> in this case is an equivalent to</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> analytics <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    sendEvent<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sendButtonClickEvent<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    sendInitEvent<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> analytics<span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">jest.fn()</code> is a handy function that will erase the current behavior of a method and replace it with a mock object. With this, we can safely invoke <code class="language-text">analytics.sendEvent()</code> for testing purposes and don't have to worry about side effects.</p>
<p>We can then perform a thorough assertions like this,</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">analytics<span class="token punctuation">.</span><span class="token function">sendEvent</span><span class="token punctuation">(</span><span class="token string">'button-click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
analytics<span class="token punctuation">.</span><span class="token function">sendEvent</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">expect</span><span class="token punctuation">(</span>analytics<span class="token punctuation">.</span>sendEvent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ✅</span>
<span class="token function">expect</span><span class="token punctuation">(</span>analytics<span class="token punctuation">.</span>sendEvent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'button-click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ✅</span>
<span class="token function">expect</span><span class="token punctuation">(</span>analytics<span class="token punctuation">.</span>sendEvent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ✅</span></code></pre></div>
<p>One downside of this kind of testing is that it utilizes implementation details of the system under test. We are exposing to the test that the system under test calls this exact function.</p>
<p><a href="https://kentcdodds.com/blog/testing-implementation-details" target="_blank" rel="nofollow noopener noreferrer">In this article</a>, Kent C. Dodds puts it well, testing implementation details are bad because of two reasons:</p>
<ol>
<li>Test can break if we refactor application codes. <strong>False negatives</strong></li>
<li>Test may not fail if we break application code. <strong>False positive</strong></li>
</ol>
<p>Both cases suggest that the test knows too much of the inner detail of the system under test.</p>
<h2>State Verification VS Behavior Verification</h2>
<p>One thing that I asked myself a lot during test was that should I use a mock or a stub?</p>
<p>It turns out, the answer to this question depends on whether it's more appropriate to perform a state verification rather than behavior verification.</p>
<p>In the article <a href="https://martinfowler.com/articles/mocksArentStubs.html#TheDifferenceBetweenMocksAndStubs" target="_blank" rel="nofollow noopener noreferrer">Mocks Aren't Stubs</a> by Martin Fowler, this decision almost always depends on context. Are we talking about easy collaboration or a rather awkward one?</p>
<p>If the collaboration is easy, for example between the <code class="language-text">Order</code> class and <code class="language-text">Warehouse</code> class, we are more likely to be able to use real objects or stubs and perform a state verification. If it's an awkward collaboration, such as collaboration between <code class="language-text">Order</code> class and <code class="language-text">MailService</code> class, we are likely to use mock and perform a behavior verification.</p>
<p>Another factor to consider is how close both of these methods of testing resembles the actual working codes. The primary issue with behavior verification is that we can't be sure that the system under test is working properly, we can only validate that certain function is called as expected. For example, if <code class="language-text">database.save(payload)</code> function is called, we can only assume that the item will be saved to the database. While with state verification, we can actually perform a query to the database to verify that the item indeed exists.</p>
<p>Of course, in the end, we need to measure the tradeoffs between the two decisions.</p>
<h2>Conclusion</h2>
<p>One thing I learned about software testing is that different testing frameworks have different takes on test doubles creation. In <code class="language-text">jest</code>, test double creation is limited to <code class="language-text">jest.mock()</code> and <code class="language-text">jest.spyOn()</code>, stub and spy are treated as the same thing, and you can use mock and stub interchangeably. While in <code class="language-text">sinon</code>, there are <code class="language-text">sinon.stub()</code>, <code class="language-text">sinon.fake()</code>, <code class="language-text">sinon.mock()</code>, and <code class="language-text">sinon.spy()</code>.</p>
<p>Test doubles are extremely valuable in helping engineers write comprehensive test suites that run fast. However, misusing them can result in a maintenance nightmare. That's why it's important for engineers to understand the ups and downs of each kind of test double. Oftentimes, engineers need to make trade-offs regarding which technique to use.</p></div></div></main><footer class="mLayout-footer"><p class="mLayout-footerCredit">© <!-- -->2022<!-- --> Frendy Guo</p></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-162139722-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/dealing-with-test-doubles/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-e4957c11759bdfc149d9.js"],"app":["/app-54ca34367b76cbcfcbfe.js"],"component---src-pages-404-js":["/component---src-pages-404-js-6dff525f7fbddb031481.js"],"component---src-pages-index-js":["/component---src-pages-index-js-0ea7fcfce77172f14c74.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-64d206a24b3414758a47.js"]};/*]]>*/</script><script src="/polyfill-e4957c11759bdfc149d9.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-64d206a24b3414758a47.js" async=""></script><script src="/commons-df320379cf55a57ae8d5.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-54ca34367b76cbcfcbfe.js" async=""></script><script src="/framework-dbb498007a7447f28d8e.js" async=""></script><script src="/webpack-runtime-22ca6dc067203d68eff5.js" async=""></script></body></html>